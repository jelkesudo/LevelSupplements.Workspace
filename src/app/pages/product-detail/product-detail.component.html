<div class="page-layout pt-100">
  <nav class="breadcrumbs">
    <div class="w-80 mx-auto d-flex justify-content-start">
      <a routerLink="/">Home</a> -
      <a routerLink="/proizvodi"> Proizvodi</a> -
      <p>{{ product.name }}</p>
    </div>
  </nav>

  <div class="product">
    <div class="image-with-caousel">
      <div class="gallery-container">
        <div class="main-image">
          <img [src]="selectedImage" alt="Main image" />
        </div>

        <p-carousel *ngIf="images.length > 1"
                    styleClass="custom-carousel"
                    [value]="images"
                    [numVisible]="5"
                    [numScroll]="1"
                    class="thumbnail-carousel"
                    [showIndicators]="false"
                    [responsiveOptions]="responsiveOptions">
          <ng-template let-image pTemplate="item">
            <img [src]="image.src"
                 [alt]="image.alt"
                 (click)="selectImage(image)"
                 [class.selected]="image.src === selectedImage" />
          </ng-template>
        </p-carousel>
      </div>
    </div>

    <div class="product-content">
      <div class="product-name"><h1>{{ product.name }}</h1></div>
      <div class="price">{{ formattedPrice }}</div>

      <div class="rating-container">
        <p-rating class="custom-rating"
                  [(ngModel)]="rating"
                  [stars]="5"
                  [readonly]="false"
                  [ngStyle]="{'--rating-width': (rating / 5) * 100 + '%'}">
        </p-rating>
      </div>

      <!-- Flavor selection -->
      <div class="flavors">
        <p>Svi ukusi</p>
        <ul>
          <li *ngFor="let f of flavors"
              class="flavor-item"
              [class.active]="f.id === selectedFlavorId"
              [class.disabled]="isFlavorDisabled(f.id!)"
              (click)="onSelectFlavor(f.id!)">
            <span class="dot" [style.backgroundColor]="f.color"></span>
            {{ f.name }}
          </li>
        </ul>
      </div>

      <!-- Pack selection -->
      <div class="order-container" *ngIf="selectedFlavorId">
        <p class="label">Pakovanje:</p>

        <div class="packages">
          <div *ngFor="let p of packsForFlavor"
               class="package"
               [class.active]="p.id === selectedPackId"
               [class.disabled]="isPackDisabled(p.id!)"
               (click)="onSelectPack(p.id!)">
            <div class="weight">{{ p.size }}{{ p.unit }}</div>
            <div class="portions">{{ getPortions(p) }}</div>
          </div>
        </div>

        <div class="actions" *ngIf="selectedVariant">
          <button class="add-btn"
                  [disabled]="isAddToCartDisabled"
                  (click)="addToCart()">
            DODAJ U KORPU
          </button>   

          <div class="quantity">
            <button (click)="decrement()">-</button>
            <input type="number"
                   [(ngModel)]="quantity"
                   (change)="onQuantityChange()" />
            <button (click)="increment()">+</button>
          </div>
        </div>

        <div class="delivery">
          <div>
            <img src="images/delivery.png" alt="delivery">
            Dostava za 5-7 radnih dana
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="harmonica-menu mt-5 mx-auto">
    <app-custom-accordion [items]="accordionData"></app-custom-accordion>
  </div>
</div>
